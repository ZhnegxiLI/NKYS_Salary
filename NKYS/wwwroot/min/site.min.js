function getElementOfArrayByPropertyValue(n,t,i){var r=[];for(element in n)if(isDefined(n[element][t])&&areEqual(n[element][t],i)){r.push(n[element]);break}return r}function areEqual(n,t){return typeof n=="string"&&typeof t=="string"?n.toLowerCase()==t.toLowerCase():n==t}function getTicks(){var n=new Date;return n.getTime()}function isDefined(n){return!isUndefinedOrNull(n)}function isUndefined(n){return typeof n=="undefined"}function isNull(n){return n==null}function isUndefinedOrNull(n){return isUndefined(n)||isNull(n)}isNullOrUndefined=isUndefinedOrNull;Application.Configuration={baseUrl:"http://localhost/NKYS/"};$(document).ready(function(){$("#DeleteCycle").on("click",function(n){var t=$(n.currentTarget).attr("data-cycle-id");$.ajax({url:"/Cycles/Delete",type:"POST",context:document.body,data:{id:t},success:{}})})});EmployeSearch=function(){var n=this;n.searchCriteria={DepartmentId:-1,GroupsId:-1};n.Employe=null;n.groupList=[];n.departmentList=[];n.employeList=[];n.init=function(){Application.Services.CommonService.FindGroupList(null,function(t){t!=null&&t.length>0&&(n.groupList=t)});Application.Services.CommonService.FindDepartmentList(null,function(t){t!=null&&t.length>0&&(n.departmentList=t);n.buildSelectOption($("#EmployeSearch_Select_DepartmentId"),n.departmentList,"Id","Name")})};n.OnChangeEmployeSearchCriteria=function(t){var u=t.currentTarget.id,i=t.currentTarget.value,r;switch(u){case"EmployeSearch_Select_DepartmentId":n.searchCriteria.DepartmentId=i;n.groupList!=null&&(r=n.groupList.filter(n=>n.DepartmentId==i),n.buildSelectOption($("#EmployeSearch_Select_GroupsId"),r,"Id","Name"));break;case"EmployeSearch_Select_GroupsId":n.searchCriteria.GroupsId=i}n.checkEmployeSearchCriteriaValidity()};n.checkEmployeSearchCriteriaValidity=function(){return n.searchCriteria.DepartmentId!=null&&n.searchCriteria.DepartmentId!=-1&&n.searchCriteria.GroupsId!=null&&n.searchCriteria.GroupsId!=-1?($("button#EmployeSearch_Button_Search").removeAttr("disabled"),!0):($("button#EmployeSearch_Button_Search").prop("disabled",!0),$("button#EmployeSearch_Button_Create").prop("disabled",!0),!1)};n.buildEmployeTable=function(){if(n.employeList!=null&&n.employeList.length>0)n.employeList.map(n=>{isDefined(n.Groups)&&(isDefined(n.Groups.Name)&&(n.GroupsLabel=n.Groups.Name),isDefined(n.Groups.IsFixSalary)&&(n.IsFixSalary=n.Groups.IsFixSalary)),isDefined(n.IsTemporaryEmploye)&&n.IsTemporaryEmploye==!0?n.TemporaryEmployeChecked=!0:n.TemporaryEmployeNoChecked=!0}),$("table#EmployeSearch_Table tbody").loadTemplate($("#Tp1_EmployeTable"),n.employeList);else{var t=$("#EmployeSearch_Table thead tr th").length;$("#EmployeSearch_Table tbody").html('<tr><td colspan="'+t+'">No data to display<\/td><\/tr>')}};n.searchEmploye=function(){n.checkEmployeSearchCriteriaValidity()==!0&&Application.Services.CommonService.GetEmployeList(n.searchCriteria,function(t){$("button#EmployeSearch_Button_Create").removeAttr("disabled");n.employeList=t!=null&&t.length>0?t:[];n.buildEmployeTable()})};n.initEmployeModal=function(t){var r=$(t.currentTarget).data("action"),u,i;r=="Create"?n.Employe=n.getEmptyEmploye():r=="Edit"?(u=$(t.currentTarget).closest("tr").attr("data-employe-id"),isDefined(n.employeList)&&n.employeList.length>0&&(i=n.employeList.find(n=>n.Id==u),isDefined(i)&&(n.Employe=i))):n.Employe=null;n.Employe!=null&&n.buildEmployeModal()};n.getEmptyEmploye=function(){return{Id:0,GroupsId:-1,Name:"",EntreEntrepriseDate:null,ExternalId:"",TechnicalLevel:"",SelfPaySocialSercurity:"",SelfPayHousingReserves:"",HasDorm:!1,TransportFee:null,PositionPay:null,IsChefOfGroup:null,SeniorityPay:null,FixSalary:null,DeductionPercentage:null,IsTemporaryEmploye:!1,DepartDate:null,EmployeDeductionConfiguration:[]}};n.buildEmployeModal=function(){n.modalEmployeeTicks="Modal_"+getTicks();Application.Main.initModal(n.modalEmployeeTicks,"Tp1_EmployeModal",{title:isDefined(n.Employe)&&isDefined(n.Employe.Id)&&n.Employe.Id>0?"Modify":"Create"},function(){$("#"+n.modalEmployeeTicks).remove()},function(){$(".selectpicker").selectpicker("refresh");isDefined(n.departmentList)&&n.departmentList.length>0&&n.buildSelectOption($("#EmployeModal_Select_DepartmentId"),n.departmentList,"Id","Name");isDefined(n.Employe)&&isDefined(n.Employe.Id)&&n.Employe.Id>0&&(isDefined(n.Employe.Groups)&&isDefined(n.Employe.Groups.DepartmentId)&&n.Employe.Groups.DepartmentId>0&&($("#EmployeModal_Select_DepartmentId").val(n.Employe.Groups.DepartmentId),$(".selectpicker").selectpicker("refresh"),$("#EmployeModal_Select_DepartmentId").trigger("change"),isDefined(n.Employe.GroupsId)&&($("#EmployeModal_Select_GroupsId").val(n.Employe.GroupsId),$(".selectpicker").selectpicker("refresh"),$("#EmployeModal_Select_GroupsId").trigger("change"))),isDefined(n.Employe.Name)&&n.Employe.Name!=""&&$("#EmployeModal_Input_Name").val(n.Employe.Name),isDefined(n.Employe.EntreEntrepriseDate)&&n.Employe.EntreEntrepriseDate!=""&&$("#EmployeModal_Input_EntreEntrepriseDate").val(n.Employe.EntreEntrepriseDate.slice(0,10)),isDefined(n.Employe.ExternalId)&&n.Employe.ExternalId!=""&&$("#EmployeModal_Input_ExternalId").val(n.Employe.ExternalId),isDefined(n.Employe.TechnicalLevel)&&n.Employe.TechnicalLevel!=""&&$("#EmployeModal_Input_TechnicalLevel").val(n.Employe.TechnicalLevel),isDefined(n.Employe.FixSalary)&&n.Employe.FixSalary!=""&&$("#EmployeModal_Input_FixSalary").val(n.Employe.FixSalary));$("button#EmployeModal_Button_Close").on("click",function(){$("#"+n.modalEmployeeTicks).modal("hide")});$("#"+n.modalEmployeeTicks).modal()})};n.OnChangeEmployeModalCriteria=function(t){var e=t.currentTarget.id,i=t.currentTarget.value,f,u,r;switch(e){case"EmployeModal_Input_Name":isDefined(i)&&i!=""?(n.Employe.Name=i,$(t.currentTarget).removeClass("is-invalid")):n.Employe.Name="";break;case"EmployeModal_Select_DepartmentId":isDefined(i)&&i>0?(n.Employe.DepartmentId=i,$("#EmployeModal_Select_DepartmentId").removeClass("is-invalid"),$("#EmployeModal_Select_DepartmentId").closest("div").removeClass("is-invalid"),$(".selectpicker").selectpicker("refresh")):(n.Employe.DepartmentId=-1,n.Employe.GroupsId=-1);n.groupList!=null&&(f=n.groupList.filter(n=>n.DepartmentId==i),n.buildSelectOption($("#EmployeModal_Select_GroupsId"),f,"Id","Name"));break;case"EmployeModal_Select_GroupsId":isDefined(i)&&i>0?(n.Employe.GroupsId=i,$("#EmployeModal_Select_GroupsId").removeClass("is-invalid"),$("#EmployeModal_Select_GroupsId").closest("div").removeClass("is-invalid"),$(".selectpicker").selectpicker("refresh"),u=n.groupList.find(n=>n.Id==i),isDefined(u)?isDefined(u.IsFixSalary)&&u.IsFixSalary==!0?($('[data-specific="FixSalary"]').removeClass("d-none"),$('[data-specific="DeductionPercentage"]').removeClass("d-none"),$('[data-specific="DeductionConfiguration"]').removeClass("d-none"),$('[data-specific="TechnicalLevel"]').addClass("d-none"),n.Employe.TechnicalLevel=null):isDefined(u.SharePropotion)&&isDefined(u.ProductionValueTypeId)?($('[data-specific="FixSalary"]').addClass("d-none"),$('[data-specific="DeductionPercentage"]').addClass("d-none"),$('[data-specific="DeductionConfiguration"]').addClass("d-none"),$('[data-specific="TechnicalLevel"]').removeClass("d-none"),n.Employe.FixSalary=null,n.Employe.DeductionPercentage=null):$("[data-specific]").removeClass("d-none"):$("[data-specific]").removeClass("d-none")):($("[data-specific]").removeClass("d-none"),n.Employe.GroupsId=-1);break;case"EmployeModal_Input_EntreEntrepriseDate":isDefined(i)&&i!=""?(n.Employe.EntreEntrepriseDate=i,$(t.currentTarget).removeClass("is-invalid")):n.Employe.EntreEntrepriseDate="";break;case"EmployeModal_Input_ExternalId":isDefined(i)&&i!=""?(n.Employe.ExternalId=i,$(t.currentTarget).removeClass("is-invalid")):n.Employe.ExternalId="";break;case"EmployeModal_Input_TechnicalLevel":n.Employe.TechnicalLevel=i;break;case"EmployeModal_Input_SelfPaySocialSercurity":n.Employe.SelfPaySocialSercurity=i;break;case"EmployeModal_Input_SelfPayHousingReserves":n.Employe.SelfPayHousingReserves=i;break;case"EmployeModal_CheckBox_HasDorm":r=$("#"+t.currentTarget.id).is(":checked");r=isDefined(r)?r:!1;n.Employe.HasDorm=r;break;case"EmployeModal_Input_TransportFee":n.Employe.TransportFee=i;break;case"EmployeModal_Input_PositionPay":n.Employe.PositionPay=i;break;case"EmployeModal_CheckBox_IsChefOfGroup":r=$("#"+t.currentTarget.id).is(":checked");r=isDefined(r)?r:!1;n.Employe.IsChefOfGroup=r;break;case"EmployeModal_Input_SeniorityPay":n.Employe.SeniorityPay=i;break;case"EmployeModal_Input_FixSalary":n.Employe.FixSalary=i;break;case"EmployeModal_Input_DeductionPercentage":n.Employe.DeductionPercentage=i;break;case"EmployeModal_Input_IsTemporaryEmploye":r=$("#"+t.currentTarget.id).is(":checked");r=isDefined(r)?r:!1;n.Employe.IsTemporaryEmploye=r;break;case"EmployeModal_Input_DepartDate":n.Employe.DepartDate=i;break;case"EmployeModal_Select_DeductionConfiguration":n.Employe.EmployeDeductionConfiguration=i}};n.saveEmployee=function(){n.checkEmployeModalValidity()==!0&&($("#"+n.modalEmployeeTicks).mask(),Application.Services.CommonService.InsertOrUpdateEmploye(n.Employe,function(t){t>0&&($("#"+n.modalEmployeeTicks).unmask(),$("#"+n.modalEmployeeTicks).modal("hide"),n.searchEmploye())}))};n.checkEmployeModalValidity=function(){var i=!1,t=n.groupList.find(t=>t.Id==n.Employe.GroupsId);return isDefined(t)&&(isDefined(t.IsFixSalary)&&t.IsFixSalary==!0&&isDefined(n.Employe.FixSalary)&&n.Employe.FixSalary>0?i=!0:isDefined(t.SharePropotion)&&isDefined(t.ProductionValueTypeId)&&isDefined(n.Employe.TechnicalLevel)&&n.Employe.TechnicalLevel>0&&(i=!0)),isDefined(n.Employe)&&isDefined(n.Employe.DepartmentId)&&n.Employe.DepartmentId>0&&isDefined(n.Employe.GroupsId)&&n.Employe.GroupsId>0&&isDefined(n.Employe.Name)&&n.Employe.Name!=""&&isDefined(n.Employe.EntreEntrepriseDate)&&n.Employe.EntreEntrepriseDate!=""&&isDefined(n.Employe.ExternalId)&&n.Employe.ExternalId!=""&&i==!0?!0:((!isDefined(n.Employe.GroupsId)||n.Employe.GroupsId<=0)&&$("#EmployeModal_Select_GroupsId").addClass("is-invalid"),(!isDefined(n.Employe.DepartmentId)||n.Employe.DepartmentId<=0)&&$("#EmployeModal_Select_DepartmentId").addClass("is-invalid"),isDefined(n.Employe.Name)&&n.Employe.Name!=""||$("#EmployeModal_Input_Name").addClass("is-invalid"),isDefined(n.Employe.EntreEntrepriseDate)&&n.Employe.EntreEntrepriseDate!=""||$("#EmployeModal_Input_EntreEntrepriseDate").addClass("is-invalid"),isDefined(n.Employe.ExternalId)&&n.Employe.ExternalId!=""||$("#EmployeModal_Input_ExternalId").addClass("is-invalid"),$(".selectpicker").selectpicker("refresh"),!1)};n.buildSelectOption=function(n,t,i,r,u){var f=' <option selected value="-1"><\/option> ';t!=null&&t.length>0&&t.map(function(n){f+=u!=null&&n[i]==u?" <option value="+n[i]+" selected>"+n[r]+"<\/option> ":" <option value="+n[i]+">"+n[r]+"<\/option> "});n!=null&&(n.html(f),n.selectpicker("refresh"))}};Application.ViewsScript.EmployeSearch=new EmployeSearch;Application.Main={PileInstantiatedModal:[],onload:function(){try{Application.Main.CurrentView!=null&&Application.ViewsScript[Application.Main.CurrentView]!=null&&Application.ViewsScript[Application.Main.CurrentView].init&&Application.ViewsScript[Application.Main.CurrentView].init()}catch(n){}},addModalInPile:function(n){var u=!1,t,i,r;if($("#"+n).is(":visible"))console.log("Crystal => addModalInPile : a modal with same id is currently visible");else if(t=getTicks(),i=getElementOfArrayByPropertyValue(Application.Main.PileInstantiatedModal,"ID",n),i.length==1)if(t-i[0].Ticks>3e4){for(u=!0,r=0;r<Application.Main.PileInstantiatedModal.length;r++)Application.Main.PileInstantiatedModal[r].ID==n&&(delete Application.Main.PileInstantiatedModal[r],Application.Main.PileInstantiatedModal.splice(r,1));$("#"+n).remove();Application.Main.PileInstantiatedModal.push({ID:n,Ticks:t});console.log("Crystal => addModalInPile : a modal was instantiated in the pile "+(t-i[0].Ticks)+" milliseconds ago (> 30000), it has now been removed.")}else console.log("Crystal => addModalInPile : a modal is instantiated in the pile "+(t-i[0].Ticks)+" milliseconds ago (< 30000) !");else i.length==0&&(u=!0,Application.Main.PileInstantiatedModal.push({ID:n,Ticks:t}));return u},initModal:function(n,t,i,r,u){var f=Application.Main.addModalInPile(n);if(f){$("body").append("<div id='"+n+"' data-backdrop='static' class='modal' tabindex='-1' role='dialog' aria-hidden='false'><\/div>");$("#"+n).loadTemplate($("#"+t),i);$("#"+n).on("hidden.bs.modal",function(){Application.Main.forceCloseModal(n);r&&r()});$("#"+n).on("shown.bs.modal",function(){});u&&u()}},forceCloseModal:function(n){$("#"+n).modal("hide");$("#"+n).html("");$("#"+n).remove();$('[data-renderto="'+n+'"]').remove();Application.Main.removeModalFromPile(n)},removeModalFromPile:function(n){if($("#"+n).length==0)for(var t=0;t<Application.Main.PileInstantiatedModal.length;t++)if(Application.Main.PileInstantiatedModal[t].ID==n){delete Application.Main.PileInstantiatedModal[t];Application.Main.PileInstantiatedModal.splice(t,1);break}}};window.onload=Application.Main.onload;Application={Configuration:{},Constants:{},Controls:{},ViewsScript:{},Services:{},Bussiness:{Services:{}}};SalarieSearch=function(){var n=this;n.employeeList=[];n.salarieList=[];n.searchCriteria={DepartmentId:-1,GroupId:-1,CycleId:-1};n.groupList=[];n.init=function(){Application.Services.CommonService.FindGroupList(null,function(t){t!=null&&t.length>0&&(n.groupList=t,console.log(n.groupList))});n.formatData()};n.OnChangeCriteria=function(t){var r,i,u;console.log(t.currentTarget);r=t.currentTarget.id;i=t.currentTarget.value;switch(r){case"SalariesSearchFilter_Select_DepartmentId":n.searchCriteria.DepartmentId=i;n.groupList!=null&&(u=n.groupList.filter(n=>n.DepartmentId==i),n.buildSelectOption($("#SalariesSearchFilter_Select_GroupId"),u,"Id","Name"));break;case"SalariesSearchFilter_Select_GroupId":n.searchCriteria.GroupId=i;break;case"SalariesSearchFilter_Select_PeriodId":n.searchCriteria.CycleId=i}n.checkCriteriaValidity()};n.buildSelectOption=function(n,t,i,r,u){var f=' <option selected value="-1"><\/option> ';t!=null&&t.length>0&&t.map(function(n){f+=u!=null&&n[i]==u?" <option value="+n[i]+" selected>"+n[r]+"<\/option> ":" <option value="+n[i]+">"+n[r]+"<\/option> "});n!=null&&n.html(f)};n.checkCriteriaValidity=function(){return n.searchCriteria.DepartmentId!=null&&n.searchCriteria.DepartmentId!=-1&&n.searchCriteria.GroupId!=null&&n.searchCriteria.GroupId!=-1&&n.searchCriteria.CycleId!=null&&n.searchCriteria.CycleId!=-1?($("button#SalariesSearchFilter_Button_Search").removeAttr("disabled"),!0):($("button#SalariesSearchFilter_Button_Search").prop("disabled",!0),!1)};n.RefreshData=function(){if(n.checkCriteriaValidity()==!0){var t=$.Deferred().done(function(t){n.employeeList=t!=null&&t.length>0?t:[]}),i=$.Deferred().done(function(t){n.salarieList=t!=null&&t.length>0?t:[]});$.when(t,i).done(function(){var t=n.formatData()});n.GetEmployeList(t);n.SalariesSearch(i)}};n.formatData=function(){n.employeeList!=null&&n.employeeList.length>0?n.employeeList.map(t=>{var i=n.salarieList.find(n=>n.EmployeId==t.Id);i!=null}):n.NoDataToDisplay()};n.NoDataToDisplay=function(){$("#SalariesSearch_Table_Body").html("<tr><td>No data to display<\/td><\/tr>")};n.GetEmployeList=function(t){Application.Services.CommonService.GetEmployeList(n.searchCriteria,function(n){n!=null?t.resolve(n):t.reject()})};n.SalariesSearch=function(t){Application.Services.CommonService.SalariesSearch(n.searchCriteria,function(n){n!=null?t.resolve(n):t.reject()})}};Application.ViewsScript.SalarieSearch=new SalarieSearch;CommonService=function(){var n=this;n.FindGroupList=function(n,t){$.ajax({url:Application.Configuration.baseUrl+"Groups/FindGroupList",type:"get",data:n,dataType:"json",success:t})};n.GetEmployeList=function(n,t){$.ajax({url:Application.Configuration.baseUrl+"Employes/GetEmployeList",type:"get",data:n,dataType:"json",success:t})};n.SalariesSearch=function(n,t){$.ajax({url:Application.Configuration.baseUrl+"Salaries/SalariesSearch",type:"get",data:n,dataType:"json",success:t})};n.FindDepartmentList=function(n,t){$.ajax({url:Application.Configuration.baseUrl+"Departments/FindDepartmentList",type:"get",data:n,dataType:"json",success:t})};n.InsertOrUpdateEmploye=function(n,t){$.ajax({url:Application.Configuration.baseUrl+"Employes/InsertOrUpdateEmploye",type:"post",data:n,dataType:"json",success:t})}};Application.Services.CommonService=new CommonService;